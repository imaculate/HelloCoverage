name: CodeCov
on: [push, pull_request]
jobs:
  run:
    runs-on: windows-latest
    name: Build, Test , Upload Code Coverage Report
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
        with:
          fetch-depth: ‘2’
        id: checkout_code
      - name: Setup MSBuild and add to PATH
        uses: microsoft/setup-msbuild@v1.0.2
        id: setup_msbuild
      - name: Run MSBuild
        id: run_msbuild
        run: msbuild HelloWorld.sln
      - name: Setup VSTest and add to PATH
        uses: darenm/Setup-VSTest@v1
        id: setup_vstest
      - name: Download OpenCppCoverage
        id: setup_opencppcoverage1
        uses: suisei-cn/actions-download-file@v1
        with:
          url: "https://github.com/OpenCppCoverage/OpenCppCoverage/releases/download/release-0.9.9.0/OpenCppCoverageSetup-x64-0.9.9.0.exe"
          target: $GITHUB_WORKSPACE
      - name: Install OpenCppCoverage
        id: setup_opencppcoverage2
        working-directory: $GITHUB_WORKSPACE
        run: OpenCppCoverageSetup-x64-0.9.9.0.exe
      - name: Generate Report
        id: gen_test_report
        working-directory: $GITHUB_WORKSPACE\Debug\
        run: OpenCppCoverage --sources BitOps -- "vstest.console.exe" OpsTest.dll
      - name: Upload Coverage to Codecov
        uses: codecov/codecov-action@v1